%!TEX root = vaisagh_thesis.tex

\chapter{Quantitative Comparison Between Motion Planning Systems for Evacuation Planning and Evaluation}
\label{chapter:MotionPlannerComparison}

The previous chapters have introduced a novel model of perception, a framework for modelling pre-evacuation behavior and an analysis into how humans explore environments. While modelling pre-evacuation and partial knowledge are both important they are not strictly essential for an agent based simulation of a crowd. In fact, as discussed in Chapter~\ref{chapter:IBP}, even perception is sometimes not given much importance in agent based models. However, the fourth essential building block from Chapter~\ref{chapter:IBEVAC} is the most fundamental and generally considered the core of the simulation. More importantly, the lower level motion planning system influences the dynamics produced by the crowd. However, despite several models having been proposed to model this there is little consensus on which is the best model to use. This chapter introduces a methodology for comparing different models of crowds and identifies a key metric that can be used in differentiating the different models~\footnote{This chapter was published in the European Physical Journal B~\cite{Viswanathan2014}}.

% In fact, the many motion planning models in the literature are structurally different, and few have been rigorously calibrated against real-world egress data, especially in emergency situations. In this chapter we describe a procedure to quantitatively compare different motion planning systems or between models and real-world data. We simulated three models: (1) the lattice gas model, (2) the social force model, and (3) the RVO2 model, and obtained the distributions of six observables: (1) evacuation time, (2) zoned evacuation time, (3) passage density, (4) total distance traveled, (5) inconvenience, and (6) flow rate. We then used the DISTATIS procedure to compute the compromise matrix of statistical distances between the three models. Projecting the three models onto the first two principal components of the compromise matrix, we find the lattice gas and RVO2 models are similar in terms of the evacuation time, passage density, and flow rates, whereas the social force and RVO2 models are similar in terms of the total distance traveled. Most importantly, we find that the zoned evacuation times of the three models to be very different from each other. Thus we propose to use this variable, if it can be measured, as the key test between different models, and also between models and the real world. Finally, we compared the model flow rates against the flow rate of an emergency evacuation during the May 2008 Sichuan earthquake, and found the social force model agrees best with this real data.
%
% \section{Introduction}
% \label{intro}

% Crowd simulation is an area that has been the subject of a significant amount of multidisciplinary work over the last few decades~\cite{Still:2000tp,Zhou:2010:CMS:1842722.1842725,Gwynne1999741}. Its applications range from simulating crowds for movies~\cite{Regelous:2011vt,Reynolds:1987vm} and games~\cite{Snape:2012,ageOfEmpires:2013} to analyzing pedestrian behavior~\cite{Helbing:1995ie,Viswanathan:ut,Guy:2010uv} and preparing for fire evacuations and similar emergencies~\cite{Klupfel:2005to,PEDFull:2011,Mordvintsev:2012}.

As discussed in Chapter~\ref{chapter:LiteratureReview}, the earliest attempts to simulate crowds generally adopted a macroscopic approach~\cite{Henderson:1974ve,WattsJr:1987tx}, where there is no explicit notion of an individual.
%Rather, the emphasis was on analyzing macroscopic features of the crowd, such as the throughput and density-velocity correlations.
Later, with increasing computational resources and with availability of observational data on an individual level~\cite{CGF:CGF1090, HuNan2013, JOHANSSON2008}, modelers were able to develop microscopic approaches~\cite{Reynolds:1987vm,Helbing:1995ie} for application in areas where it was necessary to model and analyze individuals in the crowd.
%Such models enabled the user to describe the heterogeneity of the crowd in terms of behavior, physique and emotion.
For example, in a simulation of evacuation, knowledge of the movement of crowds could reveal methods to improve crowd flow and evacuation speed.

%There are various approaches to individual-based motion planning.
One of the earliest and seminal works in individual-based motion planning was Craig Reynolds's model of coordinated animal motion such as bird flocks and fish schools~\cite{Reynolds:1987vm}. Okazaki and Matsushita~\cite{Okazaki:1993wh} assigned magnetic poles to goals, agents and obstacles to model movement. Subsequently, Helbing's Social Force Model~\cite{Helbing:1995ie} was developed, which is still one of the most popular models of movement in crowds. More recently, there have been several velocity-based approaches to motion planning, such as the synthetic vision based model~\cite{Ondrej:2010hv} and the Reciprocal Velocity Obstacle Model~\cite{vandenBerg:2011ww,Guy:2010ko,vandenBerg:2008fu}.

%Regardless of the approach, the central question of a crowd simulation is the validity of the model of movement. For most major applications of crowd simulation, a direct observation of the movement of crowds is not only useful but necessary.

The advocation of simulation-based analysis has become increasingly common over the last decade. Some well known applications include analysis of the yearly Muslim Hajj~\cite{Hughes:2003}, or more recently the Love Parade disaster, Germany 2010~\cite{Helbing:2012}. In the case of the latter, models and expertise had been used to guarantee the safety of the event, only for unforeseen circumstances to result in the deaths of 21 individuals. Clearly these real world examples emphasize the critical role that crowd modelling plays in safety preparation and planning, this in turn emphasizes the need for understanding the model dynamics, limitations and similarities. The extent to which these models are capable of accurately predicting the motion of a crowd is therefore critical for planning and safety.

Ideally these models should be validated against real-world data from all scenarios, for all cultures and for all varieties of crowd composition. Unfortunately real world data regarding egress or emergency situations is limited, often incomplete (the initial conditions are hard to know) and certainly not controlled. Even in the rare circumstances where data is available this often describes measurements and phenomena at the macro-scale, e.g., flow, density, average speed, etc. Because these models of individuals exhibit emergent behaviors at the mesoscopic and macroscopic scales, it is in general hard to tell whether the dynamics at the individual level are correct. The best researchers can realistically hope for is to collect microscopic data for a single scenario to calibrate the model. An alternative approach to the data-intensive one is to instead look quantitatively at the fundamental dynamics of the models and understand where these models differ, at the same time identifying common aspects of the models. This will aid in understanding fundamental aspects of all crowd models and offer insight into real-world dynamics of human crowds.

While much of the existing research does offer basic comparison of proposed models with existing models to demonstrate their usefulness, there is no existing quantitative comparison of the differences and similarities of these models to tell which is most accurate. The objective of this chapter is to demonstrate a methodology for quantitative comparison of simulation models in a simple egress simulation. For this, we choose three popular models that are structurally very different. Since our focus is on the comparison methodology, we do not worry about specific versions of the models, in particular recent modifications and enhancements that are supposed to produce more realistic crowd behaviors.

The contribution of this chapter is then three-fold: firstly, the analysis and comparison of these models provides interesting insight into the consequence of adopting each in particular forms of crowd or egress simulation. Secondly, the systematic approach we describe could be used in the future to compare further models and develop a standard method of comparison for crowd simulation. Finally, the chapter conclusion identifies a single measurable metric that is most effective in distinguishing the behaviour of the models.

The remainder of this chapter is organised as follows. The models that are consider in the comparison are first described in Section~\ref{Models}; Section~\ref{Methodology} describes the experiments that were conducted and the methodology for analysis. Significant observations from the simulations are presented and analyzed in Section~\ref{Discussion}. Finally, Section~\ref{Conclusions} concludes the chapter.


\section{Models}
\label{Models}

In this section we describe the three individual (or microscopic) models that are compared in this chapter. We use the general term agent to refer to individuals within each of the models. The lattice gas model is a probabilistic approach where the future location of an agent is probabilistically determined based on the current configuration of its neighborhood. This implies that the same initial configuration can produce different results during different runs. On the other hand, in the social force model and reciprocal velocity obstacle model, agents find their ways to their destinations via deterministic collision-avoiding calculations. As a result these models produce the same result on multiple runs for a particular initial configuration. The following sections give an overview of each of how each of these models work.




\subsection{Lattice gas model}
\label{LatticeGasModel}

A Cellular Automation (CA) model is one in which space and time are discrete. Furthermore, the state space of a CA model is also discrete and finite. In each time step the values of all cells are updated synchronously based on the values of cells in their neighborhoods. Depending on the type of neighborhood (i.e., von Neumann, Moore), and the type of lattice (triangular, square, hexagonal, etc.), the exact number of cells in the neighborhood of a given cell can vary~\cite{Hoekstra:2010}.
Lattice gas models are CA models that make use of a discretized version of the Boltzmann transport equation to model motion~\cite{Marconi:2002ue,Marconi2002,Nagai:2004kl}. Advances in this modelling area include the Extended Floor Field Model~\cite{nishinari2004extended} in which agents interact through virtual traces that act like the pheromones in chemotaxis, and the SWARM information model~\cite{Henein:2006jq} which uses multiple floor fields to model transmission of knowledge between agents.
%For lattice gas simulation of fluids, the choice between square grids and hexagonal grids can mean the difference between a non-ergodic phase space in the former and an ergodic phase space in the latter~\cite{Frisch:1986}. The choice of a particular lattice has to be carefully considered even though we do not explicitly simulate collisions.
In this study we use the model by Tajima and Nagatani~\cite{Tajima:2001to}. In contrast to later CA models with additional features like bi-directional movement~\cite{isobe2004experiment} and vision impairment during evacuation~\cite{Nagai:2004kl}, this original model is simple, and adequate for our model comparison purpose.

A square grid is used, and each cell
%is assumed to be the size of a person. Consequently, at any given time each cell
can be occupied by at most one person. The person performs a random walk biased towards the single exit in the room. For example, in Fig.~\ref{fig:latticeGasMovement}(a), the probability that the person takes a step in the $+y$ direction is $P_y = (1 - D)/3 + D e_y /(e_x + e_y)$, while the probability that it takes a step in the $-x$ direction is $P_{-x} = (1 - D)/3 + D e_x /(e_x + e_y)$, since the intended direction $\vec{e}$ has positive projections along the $+y$ and $-x$ directions. Along the $+x$ direction, for which $\vec{e}$'s projection is negative, the probability that the person takes a step in the $+x$ direction is $P_x = (1 - D)/3$. Here we see that the random walk probabilities contain an unbiased component $(1 - D)/n$, which is the same for all $n$ permissible directions (in the Tajima-Nagatani model, the $-y$ direction is not permitted), as well as a biased component $D = 0.7$ that favours movement towards the exit.

\begin{figure*}[!tb]
\centering
\includegraphics[width=.8\textwidth]{MotionPlanner/LatticeRule.pdf}
\caption[Working of lattice gas model]{Four out of eight possible configurations of a walker on the square lattice moving towards an exit in the direction $\vec{e}$ shown: (a) unobstructed walker, (b) walker obstructed to the left, (c) walker obstructed to the left and top, and (d) completely obstructed walker.}
\label{fig:latticeGasMovement}
\end{figure*}



\subsection{Social force model}
\label{SocialForceModel}

The social force model is one of the most popular models for motion planning in crowds~\cite{Kamphuis:2004uu,Xi:2010uc,Peng:2009cc}. This model is based on the idea that pedestrians move in response to fictitious attractive or repulsive \emph{social forces} produced by obstacles and other pedestrians.  Over the years, several extensions have been made to the social forces model like the modelling of grouping behavior~\cite{Kamphuis:2004uu}. In this paper, we use the Helbing-Moln\'ar-Farkas-Vicsek (HMFV) social force model~\cite{Helbing:1995ie}, which is tweaked from the original model introduced by Helbing and Molnar in 1995~\cite{Helbing:1995ie}. In the original model
\begin{equation} \label{eqn:SFeqn}
m_i \frac{d\vec{v}_i}{dt}=\vec{f}_{i}+\sum_{j(\neq i)}\vec{f}_{ij}+\sum_{W}\vec{f}_{iW}
\end{equation}
three types of forces act on a given agent $i$ with mass $m_i$, instantaneous position $\vec{r}_i(t)$, and instantaneous velocity $\vec{v}_i(t)$. The first is a restoring force
\begin{equation}
\vec{f}_i = -m_i \frac{\vec{v}_i-\vec{v}_0}{\tau_i}
\end{equation}
that steers the agent towards the desired velocity $\vec{v}_0$ at a rate determined by the characteristic time $\tau_i = 1$. Here
\begin{equation}
\vec{v}_0=(1-p)V_0\vec{e}_i(t)+p\left<\vec{v}_j\right>_i,
\end{equation}
where $V_0$ is the preferred speed, $\vec{e}_i$ is a vector that points towards the exit, and $(1 - p)$ is the weight given to this desired velocity. With a weight of $p$, agent $i$ also adapts to the average velocity $\left<\vec{v}_j\right>_i$ in its neighborhood. When $p$ is small, agent $i$ moves more along its intended direction $\vec{e}_i(t)$, whereas if $p$ is large, agent $i$ tends to follow where its neighbors are going. We can therefore tune $p$ from $p \approx 0$ (self-directed normal egress) to $p \approx 1$ (panic-driven herding during emergency evacuations). In this chapter, we used $p = 0.2$ to simulate an emergency evacuation situation.

The second is a repulsive force
\begin{equation}\label{eqn:repulhuman}
\begin{split}
\vec{f}_{ij} &= \lbrace A e^{(R_{ij} - d_{ij})/B} + k \eta(R_{ij}-d_{ij}) \rbrace\vec{n}_{ij} \\
&\qquad+ \kappa \eta(R_{ij}-d_{ij}) \Delta v^t_{ji}\vec{t}_{ij},
\end{split}
\end{equation}
where
\begin{equation}
\eta(x) = \left\{
  \begin{array}{l l}
    x, & \quad \text{if $x \geq 0$};\\
    0, & \quad \text{if $x < 0$}\\
  \end{array} \right.
\end{equation}
that mimics the \emph{psychological tendency} of agents $i$ and $j$ to move away from each other if they are too close. Here $R_{ij} = R_i + R_j$ is the sum of radii of the two agents, $d_{ij} = |\vec{r}_i - \vec{r}_j|$ is the physical distance between the two agents, and $\vec{n}_{ij} = (n^1_{ij},n^2_{ij}) = (\vec{r}_i-\vec{r}_j)/d_{ij}$ is the unit vector pointing from agent $j$ to agent $i$. Additionally, $A = 2000$ N and $B = 0.08$ m are the repulsion coefficient and the fall-off length of interacting agents respectively~\cite{Helbing:2000ef}. Helbing and Molnar also found it necessary to introduce two other terms in the interaction force when agents $i$ and $j$ are in contact with each other, i.e. $d_{ij} < R_{ij}$. This counteracting body compression term $k \eta(R_{ij}-d_{ij})\vec{n}_{ij}$ and sliding friction term $\kappa \eta(r_{ij}-d_{ij})\Delta v^t_{ji}\vec{t}_{ij}$ are crucial for getting realistic behaviors of panicking crowds. Here $\vec{t}_{ij} = (-n^2_{ij},n^1_{ij})$ is the tangential direction and $\Delta v^t_{ji} = (\vec{v}_j-\vec{v}_i)\cdot\vec{t}_{ij}$ is the tangential velocity difference.

Finally, in the third force
\begin{equation}\label{eqn:repulwall}
\begin{split}
\vec{f}_{iW} &= \left\{ A_i e^{(R_{i}-d_{iW})/B_i}+ k \eta(R_i - d_{iW}) \right\}\vec{n}_{iW} \\
&\qquad - \kappa \eta(r_i-d_{iW})(\vec{v}_i\cdot\vec{t}_{iW})\vec{t}_{iW},
\end{split}
\end{equation}
the first and second terms repels agent $i$ from a wall that it is $d_{iW}$ away from, while the third term (which is negative) is introduced to mimic the observation that people move faster near walls when they are in crowded situations. Here, $\vec{n}_{iW}$ is the normal vector of the wall, and $\vec{t}_{iW}$ is the tangent vector of the wall. Also, $k=12,000$ kg/s$^{2}$ and $\kappa=24,000$ kg/ms are respectively the body force constant and the sliding friction force constant used.

\subsection{Reciprocal velocity obstacles model}
\label{RVOModel}

The third model we consider is the reciprocal velocity obstacles (RVO) model. In this model, the time to the next collision is calculated based on the relative velocities of $N$ agents. Each agent then changes its velocity $\{\vec{v}_i\}_{i=1}^N$ to maximize this time to collision. By continuously updating the velocities in this manner, collisions are avoided. This algorithm was first proposed by Fiorini et al.~~\cite{Fiorini:1993hi}, but was first used in multi agent systems in~\cite{vandenBerg:2008cq}. Since then there have been several modifications and improvements to the algorithm~\cite{Guy:2009gu,Guy:2010ko,Guy:2010te,Guy:2010uv}, although the underlying idea remained the same. In this paper, we use the RVO2 model introduced by Guy et al.~\cite{Guy:2010ko}, where the collision avoidance computation is based on computational geometry and linear programming.

Given a preferred velocity, RVO2 helps an agent find the velocity closest to the preferred velocity that will enable it to avoid collisions with all other agents. This is done by determining for each neighboring dynamic and static obstacle an \emph{Optimal Reciprocal Collision Avoidance line (ORCA line) }. Each ORCA line determines the half plane in the velocity plane where the agent's velocity should lie to ensure that no collision occurs with that particular obstacle for the next $\tau$ seconds. $\tau$ is a parameter that specifies the number of seconds for which the chosen velocity should avoid a collision. From the set of half planes thus obtained, the optimal collision-avoiding velocity can be determined as the velocity within the permissible region for all the half planes that is closest to the preferred velocity. This can be determined efficiently using linear programming. Besides the speed and efficiency of the algorithm, another strong appeal of this model is that we need only set one parameter $\tau$. For the experiments in this chapter we use two values of $\tau$;  0.5 seconds or 10 simulation time steps for avoiding dynamic agents and  0.05 seconds or 1 simulation time step for avoiding static obstacles. The value of $\tau$ translates in practical terms to how early a walker tries to avoid a collision with an obstacle.


\section{Methodology}
\label{Methodology}

In this section we explain the simulations that were carried out and the analysis done. Java 6 and the MASON simulation framework~\cite{Luke:2005wc} were used for creating and running the simulations. The simulated scenario consists of agents evacuating from a simple rectangular room with a single exit. The dimensions of the room are shown in Fig.~\ref{fig:experimentalSetup}. Evacuation of the room was simulated with $N = 50, 100, 150, 200, 300, 500$ and $1000$ agents whose locations were randomly distributed within the room. For each $N$, we ran 100 simulations for each model, and the positions and velocities of all agents at all time steps were collected. For meaningful comparison between the three models, we assumed that each agent is a perfect circle with radius $R = 15$ cm~\cite{Pan:2006vp}, that has a preferred speed of 1.3 ms$^{-1}$, and a maximum speed of 2.6 ms$^{-1}$~\cite{fruin1992designing}. For the social force model we also assumed that all agents have the same mass of 60 kg.

Where possible, we have used the same settings for all three models to ensure a fair comparison. The values used for the remaining parameters required for the models was given in Sec.~\ref{Models} along with the respective models. However, to the best of our knowledge, only the social force model has been calibrated against real world data~\cite{Bauer2011}. The other two models are not calibrated beyond choosing a reasonable and believable model and the values chosen are taken such that they produce empirically believable results.


\begin{figure}[!tbp]
\centering
\includegraphics[width=\textwidth]{MotionPlanner/ExperimentSetup}
\caption{The environment setup used for the simulations in this paper.}
\label{fig:experimentalSetup}
\end{figure}

\subsection{Measurements}

Depending on the context and motivation of the model there are several metrics that are generally used. For CA models that are generally used for studying macroscopic patterns, it is common to measure macro variables like the mean evacuation time~\cite{Nagai:2004kl} and flow rate~\cite{Tajima:2001to}. For models like social force where the motivation is to study interactions at a more granular level, it is common to make empirical and qualitative observations like the lane effect~\cite{Helbing:1995ie}. Sometimes quantitative metrics like density-dependence of the flow or velocity are also measured~\cite{Seyfried2008}. From a graphics perspective, where performance is key, computation time~\cite{Ondrej:2010hv}, frame rate and run time per frame are generally measured against the number of walkers~\cite{vandenBerg:2008fu}.

In this paper, we performed two main classes of measurements: time-based and distance-based measurements. For time-based measurements, we first measured the evacuation time distributions for different number of agents. To better understand the stages in the evacuation, we also divide the room into six different zones (see Fig.~\ref{fig:Zoning}) to measure the evacuation time sub-distribution. The outer radii of Zones 1, 2, 3, 4, 5 and 6 are 5 m, 10 m, 15 m, 20 m, 25 m and 30 m respectively. We also measure the flow rate at the exit as a function of time for each model.

For distance-based measurements, we traced the trajectories of all agents to obtain the distribution of total distance travelled going from the initial position to the exit. Here, the total distance travelled $D_i$ by agent $i$ is just the sum of its displacements $\sum^{T_i}_{t=0}||\vec{r}_i(t+1)-\vec{r}_i(t)||$, where $T_i$ is the evacuated time of agent $i$. We also divide the room into $100 \times 100$ cells, and count the number of agents passing through each cell as the simulation progresses. This is then visualized as a heat map. Finally, we measure the ratio of the total distance travelled $D_i$ by agent $i$ to the minimum distance $D_{\min}$ it would cover if it evacuated along a straight line (For lattice model, $D_{min}$ is the Manhattan distance between initial position of agent and exit). This in some sense quantifies the `inconvenience', $I_i$ experienced by the agent $i$ during the evacuation.
\begin{equation}\label{eqn:Incon}
I_i=\frac{D_i}{D_{\min}}
\end{equation}

\begin{figure}[!tb]
\begin{center}
\includegraphics[scale=1.0]{MotionPlanner/Zoning}
\caption[Zonal division of environment]{In our simulations, agents are grouped into six zones based on their initial distances from the exit. The outer radii of Zones 1, 2, 3, 4, 5 and 6 are 5 m, 10 m, 15 m, 20 m, 25 m and 30 m respectively.}
\label{fig:Zoning}
\end{center}
\end{figure}


\subsection{DISTATIS}\label{sec:DISTATIS}

After making six different measurements on three models, we discovered that when we look at the flow rates, the lattice gas model is more similar to the RVO2 model. However, if we look at the total distance travelled, the social force model is more similar to the RVO2 model. If we look at the zoned evacuation times, we find that the three models have very different distributions (see Sec.~\ref{EvacTime}). Since we do not know \emph{a priori} which measurements best discriminate the three models (or for that matter, best discriminate models from the real world), we want to be able to compare the three models quantitatively, incorporating information from all six measurements.

To do so, we compute the \emph{Jensen-Shannon divergence}~\cite{Lin:1991it}
\begin{equation}
D_{JS}[f_{k\mu}, f_{k\nu}] = H[f_k] - \frac{1}{2} H[f_{k\mu}] - \frac{1}{2} H[f_{k\nu}] \geq 0
\end{equation}
between the distributions $f_{k\mu}(z)$ and $f_{k\nu}(z)$ for measurement $k$ of models $\mu$ and $\nu$. Here, $z$ is a continuous variable like evacuation time, distance travelled, or inconvenience,
\begin{equation}
H[f] = -\int dz\, f(z) \ln f(z)
\end{equation}
is the \emph{Shannon information function}, and
\begin{equation}
f_k(z) = \frac{1}{2}\left[f_{k\mu}(z) + f_{k\nu}(z)\right].
\end{equation}
If $f_{k\mu}(z)$ and $f_{k\nu}(z)$ are highly similar, we will get $D_{JS}[f_{k\mu}, f_{k\nu}] \approx 0$, whereas if $f_{k\mu}(z)$ and $f_{k\nu}(z)$ are very different, $D_{JS}[f_{k\mu}, f_{k\nu}] \gg 0$, i.e. the Jensen-Shannon divergence qualifies as a distance metric. In this way, we obtain six $3 \times 3$ distance matrices $\vec{D}_k$.

Then, we use the \emph{DISTATIS} method~\cite{Abdi:DISTATIS} for analyzing multiple distance matrices. This is a generalization of the method of principal component analysis (PCA). STATIS is an acronym for the French expression `Structuration des Tableaux \`{a} Trois Indices de la Statistique', which roughly means `structuring three way statistical tables'. The difference between a straightforward application of the PCA method and the DISTATIS method is shown in Fig.~\ref{fig:DISTATIS}. Instead of six different PCAs for the distance matrices obtained from the six different variables measured, and inevitably ending up with conflicting conclusions on which models are more similar, we standardize the six distance matrices, and ask which variables are more similar to each other.

The idea behind DISTATIS is that the data points are similarly clustered in two variables, if their standardized distance matrices in these two variables are similar to each other. Therefore, if we compute the cross correlations between variables, we will discover which variables give more similar outcomes to which other variables through a PCA. Components of the first eigenvector obtained from this PCA tells us how important each variable is. By weighting the distance matrices of each variable by its component in the first eigenvector, we construct a \emph{compromise matrix} whose matrix elements give us the most reliable similarity/dissimilarity between data points. A final PCA of this compromise matrix then gives the most reliable groups of data points. In Fig.~\ref{fig:DISTATIS1000}, we show the six independent PCA results superimposed on the PCA of the compromise matrix.

\begin{figure}[!tbp]
\centering
\includegraphics[width=\linewidth]{MotionPlanner/DISTATISWorkFlow}
\caption[Visualization of DISTATIS workflow]{In many classification problems, we can define different distance metrics for the same set of data points to measure how dissimilar they are to each other. In this figure we show three different distance matrices D1, D2, and D3. If we perform principal component analysis (PCA) on them separately (PCA1, PCA2, PCA3), we are not likely to agree on which data points are more similar to each other. In the DISTATIS method, we first standardize the distance matrices by centering and rescaling, to get S1, S2, and S3. If two data points are indeed more similar to each other than they are with the third, then we expect this similarity structure to be reflected in S1, S2, and S3, i.e.~two standardized distance matrices would have very similar patterns of matrix elements. With this in mind, we reshape the matrices S1, S2, and S3 to make them into vectors of distances. We then compute the cross correlations between these vectors, before performing PCA on the correlation matrix C. This PCA tells us which distance matrices agree with each other more, and which less. The result is a consensus between different distance metrics, based on which a single PCA will discover the similarity structure between the data points.}
\label{fig:DISTATIS}
\end{figure}

\section{Results and Discussion}
\label{Discussion}

The six measurements on the simulations are the (1) evacuation time, (2) zoned evacuation time, (3) passage density map, (4) total distance traveled, (5) inconvenience and (6) flow rate.

Here we show the results for (1) evacuation time (Fig.~\ref{fig:EvacTime}) and (2) zoned evacuation time (Fig.~\ref{fig:ZoningEvac}), (3) passage density map (Fig.~\ref{fig:DensityMap}), (4) total distance traveled (Fig.~\ref{fig:TravelDist}), (5) inconvenience (Fig.~\ref{fig:Incon}) and finally flow rate (Fig.~\ref{fig:FlowRate}) for all three models, with different number of agents.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Evacuation Time Distribution
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\subsection{Evacuation time distribution and Zoned evacuation time}
\subsection{Evacuation time}
\label{EvacTime}

As Fig.~\ref{fig:EvacTime} shows, the evacuation time distributions for all models have a uniform sub-distribution in the middle of the evacuation, which signals congestion at the exit, once we have $N > 50$ agents. However, in the RVO2 model this uniform sub-distribution is flanked by two small peaks. These two small peaks suggest a higher evacuation rate \emph{just before} congestion sets in and \emph{just before} congestion dissipates in the RVO2 model. This is not observed in real crowds, and hence is clearly an artifact of the model.

% Evacuation Time Distribution
\begin{figure*}[!tb]
\centering
\subfloat[]{\includegraphics[scale=0.35]{MotionPlanner/EvacTime/Lattice-EvacTime}\label{fig:LatticeEvacTime}}
\hspace{1cm}
\subfloat[]{\includegraphics[scale=0.35]{MotionPlanner/EvacTime/SocialForce-EvacTime}\label{fig:SocialForceEvacTime}}\\
\subfloat[]{\includegraphics[scale=0.35]{MotionPlanner/EvacTime/RVO2-EvacTime}\label{fig:RVO2EvacTime}}
\caption[Evacuation time distributions]{Evacuation time distributions for the (a) lattice gas, (b) social force, and (c) RVO2 models for $N = 50, 100, 150, 200, 300, 500, 1000$ agents. For each model and $N$, the distribution is built from 100 simulations.}
\label{fig:EvacTime}
\end{figure*}

Comparing the three models, we find that the social force model has the longest evacuation times of up to five minutes. More importantly, careful inspection reveals fluid-like crowd dynamics around the exit in the RVO2 and lattice gas models. These can be seen in our  videos \url{http://www.youtube.com/watch?v=P64p3nlH_P4} and  \url{http://www.youtube.com/watch?v=vJ0Nzi5Bykw}. In the RVO2 model, an obvious back flow can also be seen during the sudden gush of agents toward the exit. Due to the strong repulsion forces, we see a solid-like behavior in the social force model when the exit becomes congested (see our video \url{http://www.youtube.com/watch?v=3Ot7m959_yo}).

In addition, we divided the room into six zones, as shown in Fig.~\ref{fig:Zoning}, based on the distance to the exit, to determine how strongly the crowds mix in the three models. The distributions of zoned evacuation times are shown in Fig.~\ref{fig:ZoningEvac}. These tell us that mixing is strong in the lattice gas and RVO2 models, but weak in the social force model. This mixing dynamics can be seen more clearly from our videos \url{http://www.youtube.com/watch?v=qeoJotgEUxk} (lattice gas), \url{http://www.youtube.com/watch?v=uZpd5LODYZs} (RVO2), and \url{http://www.youtube.com/watch?v=wEB6Ya0o_yw} (social force).

From the movies of the lattice gas and RVO2 simulations, we see that agents from the nearer zones get pushed to the side once there is congestion at the exit. In these two models, agents prefer to keep moving when it is possible for them to do so. Agents in the social force model behave differently: once the exit becomes congested, they will become nearly stationary and wait for their turn to go through the exit.



% Zoning Evacuation Distribution
\begin{figure*}[!tb]
\centering
\subfloat[]{\includegraphics[scale=0.35]{MotionPlanner/ZoningEvac/Lattice1-1000-ZoningEvac}\label{fig:LatticeZoningEvac1000}}
\hspace{1cm}
\subfloat[]{\includegraphics[scale=0.35]{MotionPlanner/ZoningEvac/SocialForce1-1000-ZoningEvac}\label{fig:SocialForceZoningEvac1000}}\\
\subfloat[]{\includegraphics[scale=0.35]{MotionPlanner/ZoningEvac/RVO21-1000-ZoningEvac}\label{fig:RVO2ZoningEvac1000}}
\caption[Zoned evacuation time distributions]{Zoned evacuation time distributions for the (a) lattice gas, (b) social force, and (c) RVO2 models for $N = 1000$ agents in six zones, with zone 1 closest to the exit and zone 6 furthest away (see Figure~\ref{fig:Zoning}). For each model, the distribution is averaged over 100 simulations.}
\label{fig:ZoningEvac}
\end{figure*}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Passage density
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Passage density}

% Density map
\begin{figure*}[!tb]
\centering
\subfloat[]{\includegraphics[scale=0.35]{MotionPlanner/DensityMap/Lattice1-1000DensityMap}\label{fig:LatticeDensityMap}}
\hspace{2cm}
\subfloat[]{\includegraphics[scale=0.35]{MotionPlanner/DensityMap/SocialForce1-1000DensityMap}\label{fig:SocialForceDensityMap}}\\
\subfloat[]{\includegraphics[scale=0.35]{MotionPlanner/DensityMap/RVO21-1000DensityMap}\label{fig:RVO2DensityMap}}
\caption[Passage density maps]{Passage density maps of $N = 1000$ agents averaged over 100 simulations for the (a) lattice gas, (b) social force, and (c) RVO2 models. In these color maps, the exit is located at the bottom.}
\label{fig:DensityMap}
\end{figure*}


The passage density heat map of agent locations averaged over 100 simulations provides information about the spatial-temporal trace of agents during their evacuation. This is crucial when analyzing the spatial structure of congestions. In Fig.~\ref{fig:LatticeDensityMap}, we see a channel leading straight through the exit. This channel acts as an attractor, because once an agent gets onto this, it will be forced statistically towards the exit ($P_{t,y} = 1.00$). Though not as pronounced as for the lattice gas model, two left-right symmetric channels also formed in the RVO2 model (Fig.~\ref{fig:RVO2DensityMap}). These two channels point roughly from the centers of mass of the left and right halves of the room towards the exit. No such artificial channels can be seen in the passage density map of the social force model (Fig.~\ref{fig:SocialForceDensityMap}).


Comparing the three models, we also see that the RVO2 model (Fig.~\ref{fig:RVO2DensityMap}) has the most compact passage density, whereas the social force model (Fig.~\ref{fig:SocialForceDensityMap}) has the least compact passage density. In particular, in the region just in front of the exit, the RVO2 model gives rise to very high passage density. This high passage density cannot be attributed to agents stepping over a cell once or twice, as in the lattice gas and social force models. In the RVO2 model, this high passage density is produced by repeated visits to the same cell by individual agents that are always moving.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Travel distance and inconvenience
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Total distance traveled distribution and inconvenience}
To measure the difficulty (inconvenience) for an agent to squeeze through the crowd during evacuation, we measured the \emph{total distance traveled} and as well as the \emph{inconvenience} (defined in Eq.~\ref{eqn:Incon}). As we can see in Fig.~\ref{fig:SocialForceTravDist} and Fig.~\ref{fig:RVO2TravDist}, the distributions of total distance traveled are very similar for the social force and RVO2 models. The lattice gas model, on the other hand, has very different distributions of total distance traveled (Fig.~\ref{fig:LatticeTravDist}). This is because space is continuous in the two former models, but discrete in the lattice gas model.

However, when we compare the distributions of inconveniences in Fig.~\ref{fig:Incon}, we find the lattice gas model is more qualitatively similar to the RVO2 model, though the typical inconveniences in the lattice gas model are larger than the those in the RVO2 model. For different $N$, the distribution peaks around the same inconvenience for both models. In contrast, the peak position of the inconvenience distribution of the social force model depends strongly on the number of agents in the simulation.


% Travel Distance Distribution
\begin{figure*}[!tb]
\centering
\subfloat[]{\includegraphics[width=0.45\textwidth]{MotionPlanner/TravDist/Lattice-TravDist}\label{fig:LatticeTravDist}}
\hspace{1cm}
\subfloat[]{\includegraphics[width=0.45\textwidth]{MotionPlanner/TravDist/SocialForce-TravDist}\label{fig:SocialForceTravDist}}
\\
\subfloat[]{\includegraphics[width=0.45\textwidth]{MotionPlanner/TravDist/RVO2-TravDist}\label{fig:RVO2TravDist}}
\caption[Distributions of total distance traveled]{Distributions of total distance traveled for the (a) lattice gas, (b) social force, and (c) RVO2 models. For each model and $N$, the distribution is averaged over 100 simulations.}
\label{fig:TravelDist}
\end{figure*}

% Inconvenience
\begin{figure*}[!tb]
\centering
\subfloat[]{\includegraphics[width=0.45\textwidth]{MotionPlanner/Incon/Lattice-Incon}\label{fig:LatticeIncon}}
\hspace{1cm}
\subfloat[]{\includegraphics[width=0.45\textwidth]{MotionPlanner/Incon/SocialForce-Incon}\label{fig:SocialForceIncon}}
\\
\subfloat[]{\includegraphics[width=0.45\textwidth]{MotionPlanner/Incon/RVO2-Incon}\label{fig:RVO2Incon}}
\caption[Distributions of inconveniences]{Distributions of inconveniences for the (a) lattice gas, (b) social force, and (c) RVO2 models. For each model and $N$, the distribution is averaged over 100 simulations.}
\label{fig:Incon}
\end{figure*}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Flow Rate and real data
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\subsection{Comparison between simulated flow rate and real data}
\subsection{Evacuation rate}

We also measured the flow rate of agents at the exit. As shown in Fig.~\ref{fig:LatticeFlowRate}, the flow rate of the lattice gas model saturates at around 11.8 persons per second due to the finite sizes of the agents and the exit. The social force model has the lowest flow rate of 2.2 people per second (Fig.~\ref{fig:SocialForceFlowRate}), because agents slow down dramatically at the end as a result of strong repulsive forces between agents. From Fig.~\ref{fig:RVO2FlowRate}), we see the same peaks before and after the congestion period for the RVO2 model, a consequence of the liquid-like dynamics of RVO2 crowds.

In an attempt to compare simulation results with real data we obtained a number of videos showing real-life evacuations~\cite{Yang2013,Yang2011} during the Sichuan Earthquake on May 12, 2008. We analysed two such videos, \url{http://www.youtube.com/watch?v=-y38ebiAnQw} and \url{http://www.youtube.com/watch?v=e1yapP3z_L4}.
Because the geometry of the scene and the viewing angles are not known, we could only measure the flow rates on a second-by-second basis from these two videos (Fig.~\ref{fig:RealData}), for comparison against what we measured in our simulations. Unlike the computational study, where we could average over 100 simulations to get smoothly varying flow rates, the flow rates measured from the videos are noisy. However, sensible comparisons can still be made. In \url{http://www.youtube.com/watch?v=-y38ebiAnQw}, the crowd is shown to evacuate through the check-out counters of a Walmart supermarket. The flow rate was high, but there was no congestion, because of the wide exit. This flow rate cannot be compared against our simulations of evacuation through a narrow exit.

In \url{http://www.youtube.com/watch?v=e1yapP3z_L4}, students were evacuating their classroom through a narrow door. From the video, we see that the width of the door allows no more than three school children to exit simultaneously. Therefore, the exit dimensions seem to correspond to the exit dimensions use in our simulations. From Fig.~\ref{fig:RealData}, we see that the average flow rate in the congestion phase is about 3 persons per second. This is far below the congestion flow rate in the lattice gas model, and very close to the congestion flow rate of the social force model. Based on this observable, we find that the social force model agrees best with the real data. This small test also tells us that the three models can be distinguished through their congestion flow rates, if other observables could not be measured.


% Flow rate
\begin{figure*}[!tbp]
\centering
\subfloat[]{\includegraphics[width=0.45\textwidth]{MotionPlanner/FlowRate/Lattice-FlowRate}\label{fig:LatticeFlowRate}}
\hspace{1cm}
\subfloat[]{\includegraphics[width=0.45\textwidth]{MotionPlanner/FlowRate/SocialForce-FlowRate}\label{fig:SocialForceFlowRate}}
\\
\subfloat[]{\includegraphics[width=0.45\textwidth]{MotionPLanner/FlowRate/RVO2-FlowRate}\label{fig:RVO2FlowRate}}
\caption[Visualization of flow rates]{Flow rates at the exit as functions of time for the (a) lattice gas, (b) social force, and (c) RVO2 models. For each model and $N$, the flow rate is averaged over 100 simulations.}
\label{fig:FlowRate}
\end{figure*}

\begin{figure}[!tbp]
\centering
\includegraphics[width=8cm]{MotionPlanner/Flowrate}
\caption[Flow rates during Sichuan earthquake equation]{The flow rates for evacuation during the May 2008 Sichuan Earthquake: (top) through the check-out counters of a Walmart supermarket in Chengdu, China (\url{http://www.youtube.com/watch?v=-y38ebiAnQw}); and (bottom) through the narrow exit of a classroom in an elementary school in Sichuan, China (\url{http://www.youtube.com/watch?v=e1yapP3z_L4}).}
\centering
\label{fig:RealData}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DISTATIS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{DISTATIS comparison}

\begin{figure}[!tbp]
\centering
\includegraphics[scale=0.8]{MotionPlanner/DISTATISFinalDISTATISMat1-1000}
\caption[DISTATIS analysis of three models]{The DISTATIS analysis of the three models with $N = 1000$ agents. In this plot, $\tau$ is the quality of compromise, and $\lambda$ is the eigenvalue.}
\label{fig:DISTATIS1000}
\end{figure}

Finally, we make use of the DISTATIS method explained in Sec.~\ref{sec:DISTATIS} to compare the three models with all six different measurements. Fig.~\ref{fig:DISTATIS1000} shows the different measurements of the three models projected onto their first two principal components. The barycenters for the three models are also shown. From Fig.~\ref{fig:DISTATIS1000} we see that based on the total distance traveled (green), the social force and RVO2 models have similar distributions, which are both very different from that of the lattice gas model. On the other hand, the lattice gas and RVO2 models have similar distributions that are significantly different from that of the social force model.

More importantly, we find the clustering of some observables: evacuation time, passage density, and flow rate all tells us that the lattice gas model is similar to the RVO2 model, and different from the social force model. We also find the inconvenience and zoned evacuation time provide some indication that the three models are qualitatively different. In fact, the DISTATIS method indicates that the zoned evacuation time is one key metric that clearly distinguishes the three models. Therefore, any real world experiments should attempt to measure this as it is this observable maximally discriminates between the three models and therefore it is reasonable to expect it will also discriminate between real-world data and the models.

\section{Conclusion}
\label{Conclusions}

To conclude, we simulated emergency evacuation from a rectangular room with a single narrow exit using three models: (1) lattice gas, (2) social force, and (3) RVO2, with different starting number of agents in the room. From these simulations, we measured six observables: (1) evacuation time, (2) zoned evacuation time, (3) passage density, (4) total distance traveled, (5) inconvenience and (6) flow rate. Besides qualitative comparison of the various distributions obtained, we also compared the three models quantitatively using the DISTATIS method. Comparing the evacuation time, passage density, and flow rate distributions, we find that the lattice gas and RVO2 models are similar, both of which are very different from the social force model. On the other hand, if we compare the distribution of total distance traveled, the social force and RVO2 models are more similar to each other, and very different from the lattice gas model. We compared the simulated congestion flow rates of the three models to congestion flow rates of school children evacuating from their classroom during the May 2008 Sichuan Earthquake, and find based on this observable that the social force model agrees best with the egress data. Finally, from an analysis of the DISTATIS we have identified the zoned evacuation time as the one observable metric that can best discriminate between these models, and also between models and real-world data. This could be invaluable in verifying new models and even existing models when new and more detailed video data is available.
The next chapter summarizes and concludes the thesis.